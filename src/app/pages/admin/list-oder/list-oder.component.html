<!-- component -->

<div class="ml-[400px] pb-[100px] lg:w-[75%] xl:w-[80%] 2xl:w-[85%] ">
  <!-- orders.component.html -->

  <div class="flex">
    <div>
      <label for="status">Chọn trạng thái:</label>
      <select id="status" [(ngModel)]="selectedStatus">
        <option value="">Tất cả</option>
        <option value="Đã xác nhận">Đã xác nhận</option>
        <option value="Đang giao hàng">Đang giao hàng</option>
        <option value="Đã giao hàng">Đã giao hàng</option>
        <option value="Đã hủy">Đã hủy</option>
        <!-- Thêm các trạng thái khác nếu cần -->
      </select>
      <button (click)="filterOrders()">Lọc</button>
    </div>
    <button class="ml-[300px]" (click)="showloyalCustomers()">
      <svg *ngIf="showloyalCustomer" xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor" class="bi bi-person-hearts" viewBox="0 0 16 16">
        <path fill-rule="evenodd" d="M11.5 1.246c.832-.855 2.913.642 0 2.566-2.913-1.924-.832-3.421 0-2.566M9 5a3 3 0 1 1-6 0 3 3 0 0 1 6 0m-9 8c0 1 1 1 1 1h10s1 0 1-1-1-4-6-4-6 3-6 4m13.5-8.09c1.387-1.425 4.855 1.07 0 4.277-4.854-3.207-1.387-5.702 0-4.276ZM15 2.165c.555-.57 1.942.428 0 1.711-1.942-1.283-.555-2.281 0-1.71Z"/>
      </svg>
      <svg *ngIf="!showloyalCustomer" xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor" class="bi bi-person" viewBox="0 0 16 16">
        <path d="M8 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6m2-3a2 2 0 1 1-4 0 2 2 0 0 1 4 0m4 8c0 1-1 1-1 1H3s-1 0-1-1 1-4 6-4 6 3 6 4m-1-.004c-.001-.246-.154-.986-.832-1.664C11.516 10.68 10.289 10 8 10c-2.29 0-3.516.68-4.168 1.332-.678.678-.83 1.418-.832 1.664z"/>
      </svg>
    </button>
    <button (click)="exportexcel()" class="bg-gray-300 w-[100px] ml-[70px] hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded inline-flex items-center">
      <svg class="fill-current w-4 h-4 mr-2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M13 8V2H7v6H2l8 8 8-8h-5zM0 18h20v2H0v-2z"/></svg>
      <span>Excel </span>
    </button>
    <!-- <div>
      <label for="search">Tìm kiếm:</label>
      <input type="text" id="search" [(ngModel)]="searchTerm" (input)="searchOrders()">
    </div> -->
  </div>
  
  <div *ngIf="orders.length > 0">
    <h2>Danh sách đơn hàng</h2>
    <table class="table table-bordered table-striped w-[1300px]" *ngIf="!showloyalCustomer" >
      <thead class="thead-dark">
        <tr>
          <th scope="col">STT</th>
          <th scope="col">Order ID</th>
          <th scope="col" (click)="sortTable('createdAt')"  class="cursor-pointer">
            Ngày tạo
            <i *ngIf="sortBy === 'createdAt'" class="bi bi-arrow-up-down"></i>
          </th>
          <th scope="col" (click)="sortTable('name')"  class="cursor-pointer">
            Thông tin khách hàng
            <i *ngIf="sortBy === 'name'" class="bi bi-arrow-up-down"></i>
          </th>
          <th scope="col" >Sản phẩm đã đặt</th>
          <th scope="col" >Trạng thái</th>
          <th scope="col" (click)="sortTableByPrice()"  class="cursor-pointer">
            Tổng giá
            <i class="bi bi-caret-down-fill" *ngIf="sortPriceOrder === 'asc'"></i>
            <i class="bi bi-caret-up-fill" *ngIf="sortPriceOrder === 'desc'"></i>
          </th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let order of orders, index as i ">
          <td>{{ i + 1 }}</td>
          <td>{{ order._id }}</td>
          <td>{{ order.createdAt | date:'dd/MM/yyyy HH:mm' }}</td>
          <td>
            <p>Người nhận: {{ order.name }}</p>
            <p>Số điện thoại: {{ order.mobile }}</p>
            <p>Email: {{ order.email }}</p>
            <p>Địa chỉ nhận hàng: {{ order.address }}</p>
          </td>
          <td >
              <div *ngFor="let product of order.products">
                <p>Sản phẩm: {{ product.product.title }} </p>
                <p>Số lượng: {{product.quantity}}</p> 
                <p>Size: {{product.size}}</p> 
                <p>Giá: {{product.product.price}}</p>
              </div>
             
            </td>
          <td>
            
            <select [(ngModel)]="order.status" (change)="updateStatus(order._id, order.status)">

              <option [value]="order.status" [selected]="true">{{ order.status }}</option>

              <option value="Đã xác nhận">Đã xác nhận</option>
              <option value="Đang giao hàng">Đang giao hàng</option>
              <option value="Đã giao hàng">Đã giao hàng</option>
              <option value="Đã hủy">Đã hủy</option>

            </select>

          </td>
          <td>{{ order.totalPrice | currency:'VND':'symbol':'1.0-0' }}</td>
       
        </tr>
      </tbody>
    </table>
  </div>
  <div *ngIf="orders.length === 0">
    <p>Không có sản phẩm cần tìm.</p>
  </div>
</div>
